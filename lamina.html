<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Clube Morpheus</title>
  <link rel="icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #fff;
      font-family: "DM Sans", sans-serif;
      color: #000;
      height: 100%;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.9);
      padding: 10px 20px;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 10;
      color: white;
      box-sizing: border-box;
    }

    .navbar .welcome {
      font-weight: bold;
    }

    .navbar .links {
      display: flex;
      gap: 20px;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.2s ease-in-out;
    }

    .navbar a:hover {
      transform: scale(1.1);
    }

    .container {
      margin-top: 60px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 20px 0;
      min-height: calc(100vh - 80px);
    }

    .header-info {
      width: 95%;
      max-width: 1200px;
      text-align: left;
      margin-bottom: 20px;
    }

    .header-info h1 {
      font-size: 22px;
      color: #1E4DB7;
      margin: 0 0 2px 0;
      text-align: left;
    }

    .cnpj {
      font-size: 13px;
      color: #555;
      margin: 0 0 2px 0;
      text-align: left;
    }

    .subtitle {
      font-size: 13px;
      color: #555;
      margin: 0;
      text-align: left;
    }

    /* CORREÇÃO: Garantir mesma largura para gráficos e tabela */
    .charts-main-container,
    .data-table-container {
      width: 95%;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .charts-main-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 30px;
    }

    .main-chart-container {
      flex: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .chart-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 400px;
      background-color: #fff;
      border-radius: 8px;
      padding: 10px;
      box-sizing: border-box;
    }

    canvas {
      width: 100%;
      height: 380px !important;
    }

    .side-charts-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-width: 250px;
    }

    .side-chart {
      background-color: #fff;
      border-radius: 0;
      padding: 15px;
      box-shadow: none;
    }

    .side-chart h3 {
      font-size: 14px;
      color: #000000;
      margin: 0 0 15px 0;
      text-align: center;
      font-weight: 600;
      font-family: "Montserrat", sans-serif;
      letter-spacing: 0.5px;
    }

    .side-chart canvas {
      height: 120px !important;
    }

    .data-table-container {
      margin-top: 30px;
      overflow: visible;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-family: "Montserrat", sans-serif;
      margin-bottom: 20px;
      border: none;
      table-layout: fixed;
    }

    .data-table th {
      background-color: #164CAD;
      color: white;
      padding: 8px 4px;
      text-align: center;
      font-weight: bold;
      border: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .data-table td {
      padding: 6px 4px;
      text-align: center;
      border: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .data-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .data-table tr:hover {
      background-color: #f1f1f1;
    }

    .data-table .header-row {
      background-color: #164CAD;
      color: white;
    }

    .data-table .column-w {
      background-color: #164CAD;
      color: white;
      font-weight: bold;
    }

    .data-table th:nth-last-child(3),
    .data-table td:nth-last-child(3) {
      border-right: 2px solid #a3a3a3;
    }

    .data-table .merged-cell {
      vertical-align: middle;
    }

    .data-table th:nth-child(n+4),
    .data-table td:nth-child(n+4) {
      width: 50px;
      min-width: 50px;
      max-width: 50px;
    }

    .data-table th:nth-child(1),
    .data-table td:nth-child(1) {
      width: 80px;
    }

    .data-table th:nth-child(2),
    .data-table td:nth-child(2) {
      width: 70px;
    }

    .data-table th:nth-child(3),
    .data-table td:nth-child(3) {
      width: 60px;
    }

    .desktop-device .data-table {
      font-size: 14px;
    }

    .desktop-device .data-table th,
    .desktop-device .data-table td {
      padding: 10px 6px;
    }

    /* ESTILOS PARA SMARTPHONE VERTICAL */
    .mobile-device .charts-main-container,
    .mobile-device .data-table-container {
      width: 98%;
      max-width: none;
    }

    .mobile-device .charts-main-container {
      flex-direction: column;
      gap: 20px;
    }

    .mobile-device .main-chart-container {
      flex: none;
      width: 100%;
    }

    .mobile-device .chart-container {
      width: 100%;
      height: 350px;
    }

    .mobile-device .main-chart-container canvas {
      height: 330px !important;
    }

    .mobile-device .side-charts-container {
      flex: none;
      flex-direction: row;
      gap: 15px;
      width: 100%;
    }

    .mobile-device .side-chart {
      flex: 1;
      width: 50%;
    }

    .mobile-device .side-chart h3 {
      font-size: 16px;
    }

    .mobile-device .side-chart canvas {
      height: 140px !important;
    }

    .mobile-device .data-table-container {
      padding: 0 10px;
    }

    .mobile-device .data-table {
      font-size: 11px;
      margin: 0 auto;
    }

    .mobile-device .data-table th,
    .mobile-device .data-table td {
      padding: 4px 2px;
    }

    .mobile-device .data-table th:nth-child(n+4),
    .mobile-device .data-table td:nth-child(n+4) {
      width: 45px;
      min-width: 45px;
      max-width: 45px;
    }

    .mobile-device .data-table th:nth-child(1),
    .mobile-device .data-table td:nth-child(1) {
      width: 70px;
    }

    .mobile-device .data-table th:nth-child(2),
    .mobile-device .data-table td:nth-child(2) {
      width: 60px;
    }

    .mobile-device .data-table th:nth-child(3),
    .mobile-device .data-table td:nth-child(3) {
      width: 50px;
    }

    /* ESTILOS PARA MOBILE LANDSCAPE */
    .mobile-landscape .charts-main-container,
    .mobile-landscape .data-table-container {
      width: 98%;
      max-width: 1200px;
    }

    .mobile-landscape .charts-main-container {
      flex-direction: row;
      gap: 15px;
    }

    .mobile-landscape .main-chart-container {
      flex: 1.8;
    }

    .mobile-landscape .side-charts-container {
      flex: 1;
      flex-direction: column;
      gap: 15px;
    }

    .mobile-landscape .side-chart {
      width: 100%;
    }

    .mobile-landscape .side-chart h3 {
      font-size: 14px;
    }

    .mobile-landscape .side-chart canvas {
      height: 100px !important;
    }

    .mobile-landscape .chart-container {
      height: 300px;
    }

    .mobile-landscape .main-chart-container canvas {
      height: 280px !important;
    }

    /* CORREÇÃO: Garantir alinhamento perfeito da tabela em landscape */
    .mobile-landscape .data-table-container {
      padding: 0;
    }

    .mobile-landscape .data-table {
      font-size: 10px;
      width: 100%;
      table-layout: fixed;
    }

    .mobile-landscape .data-table th,
    .mobile-landscape .data-table td {
      padding: 4px 2px;
    }

    .mobile-landscape .data-table th:nth-child(n+4),
    .mobile-landscape .data-table td:nth-child(n+4) {
      width: 40px;
      min-width: 40px;
      max-width: 40px;
    }

    .mobile-landscape .data-table th:nth-child(1),
    .mobile-landscape .data-table td:nth-child(1) {
      width: 60px;
    }

    .mobile-landscape .data-table th:nth-child(2),
    .mobile-landscape .data-table td:nth-child(2) {
      width: 50px;
    }

    .mobile-landscape .data-table th:nth-child(3),
    .mobile-landscape .data-table td:nth-child(3) {
      width: 45px;
    }

    .loading {
      color: #666;
      font-style: italic;
    }

    .error {
      color: #ff0000;
      background-color: #ffe6e6;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }

    #deviceInfo {
      text-align: center;
      font-size: 16px;
      margin: 20px 0;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="welcome" id="welcomeUser">Bem-vindo(a)</div>
    <div class="links">
      <a href="dashboard.html">Dashboard</a>
      <a href="lamina.html">Lâmina</a>
      <a href="comparacao-fundos.html">Comparação com Fundos</a>
      <a href="#" id="logoutLink">Sair</a>
    </div>
  </div>

  <div class="container">
    <div class="header-info">
      <h1>Morpheus Clube de Investimentos</h1>
      <div class="cnpj">61.043.820/0001-55</div>
      <div class="subtitle" id="subtitle">Carregando dados...</div>
    </div>
    
    <div class="charts-main-container">
      <div class="main-chart-container">
        <div class="chart-container">
          <canvas id="performanceChart"></canvas>
        </div>
      </div>
      
      <div class="side-charts-container">
        <div class="side-chart">
          <h3>Concentração da Carteira</h3>
          <canvas id="concentracaoChart"></canvas>
        </div>
        
        <div class="side-chart">
          <h3>Concentração da Carteira Ex Nasdaq-100</h3>
          <canvas id="concentracaoExNasdaqChart"></canvas>
        </div>
      </div>
    </div>
    
    <div class="data-table-container">
      <div class="loading" id="tableLoading">Carregando tabela...</div>
      <table class="data-table" id="dataTable" style="display: none;">
      </table>
    </div>

    <div id="deviceInfo"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYLyEfTVl8zR1drcNYi7K33IT6ytVJYJ8",
      authDomain: "login-site-9cbbd.firebaseapp.com",
      projectId: "login-site-9cbbd",
      storageBucket: "login-site-9cbbd.appspot.com",
      messagingSenderId: "703993528666",
      appId: "1:703993528666:web:1e7a02cb5b611e24c97363",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const docRef = doc(db, "usuarios", user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          const nome = data.nome || "Usuário";
          const genero = (data.genero || "masculino").toLowerCase();
          const saudacao = genero === "feminino" ? "Bem-vinda" : "Bem-vindo";
          document.getElementById("welcomeUser").textContent = `${saudacao}, ${nome}`;
        }
      } else {
        window.location.href = "index.html";
      }
    });

    document.getElementById("logoutLink").addEventListener("click", (e) => {
      e.preventDefault();
      signOut(auth).then(() => window.location.href = "index.html");
    });

    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0orwAIfSmQxmbGdGCvjj3CZNbRnqo3Fr0ujodTX3JIcptCrR_ElNMZZn8tJ7MVg1W7Zeu5-KvLQLM/pub?gid=0&single=true&output=csv";

    // Variável global para armazenar as instâncias dos gráficos
    window.chartInstances = {
      performanceChart: null,
      concentracaoChart: null,
      concentracaoExNasdaqChart: null
    };

    async function loadData() {
      try {
        console.log("Iniciando carregamento de dados...");
        
        const response = await fetch(csvUrl);
        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const data = await response.text();
        console.log("Dados CSV carregados:", data.substring(0, 200));
        
        const rows = data.split("\n").filter(row => row.trim() !== '');
        console.log("Número de linhas:", rows.length);

        if (rows.length < 2) {
          throw new Error("Dados insuficientes no CSV");
        }

        const allDates = [];
        const morpheus = [];
        const ibov = [];

        for (let i = 1; i < rows.length; i++) {
          const cols = rows[i].split(",");
          if (cols.length >= 12) {
            const date = cols[9]?.trim();
            const f1 = parseFloat(cols[10]);
            const f2 = parseFloat(cols[11]);
            
            if (date && !isNaN(f1) && !isNaN(f2)) {
              allDates.push(date);
              morpheus.push((f1 - 1) * 100);
              ibov.push((f2 - 1) * 100);
            }
          }
        }

        console.log("Dados processados - Datas:", allDates.length, "Morpheus:", morpheus.length, "IBOV:", ibov.length);

        if (allDates.length === 0) {
          throw new Error("Nenhum dado válido encontrado para o gráfico");
        }

        const lastDate = allDates[allDates.length - 1];
        document.getElementById("subtitle").textContent = lastDate;

        createMainChart(allDates, morpheus, ibov);
        createSideCharts(rows);
        loadTableData(rows);

      } catch (error) {
        console.error("Erro ao carregar dados:", error);
        document.getElementById("subtitle").textContent = "Erro ao carregar dados";
        document.getElementById("tableLoading").textContent = `Erro: ${error.message}`;
        document.getElementById("tableLoading").className = "error";
      }
    }

    function createMainChart(allDates, morpheus, ibov) {
      const morpheusData = allDates.map((date, i) => ({
        x: date.split("/").reverse().join("-"),
        y: morpheus[i]
      }));

      const ibovData = allDates.map((date, i) => ({
        x: date.split("/").reverse().join("-"),
        y: ibov[i]
      }));

      const canvas = document.getElementById("performanceChart");
      const ctx = canvas.getContext("2d");

      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);

      const isMobile = document.body.classList.contains('mobile-device');
      const axisFontSize = isMobile ? 17 : 15;
      const legendFontSize = isMobile ? 14 : 12;

      const createGradient = (ctx, chartArea) => {
        const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
        gradient.addColorStop(0, "#F6F8FC");
        gradient.addColorStop(0.5, "#8EA8D7");
        gradient.addColorStop(1, "#164CAD");
        return gradient;
      };

      window.chartInstances.performanceChart = new Chart(ctx, {
        type: "line",
        data: {
          datasets: [
            {
              label: "Morpheus",
              data: morpheusData,
              borderColor: "#164CAD",
              borderWidth: 1.5,
              pointRadius: 0,
              tension: 0.15,
              fill: true,
              backgroundColor: function(context) {
                const chart = context.chart;
                const {ctx, chartArea} = chart;
                if (!chartArea) {
                  return null;
                }
                return createGradient(ctx, chartArea);
              },
              order: 2,
            },
            {
              label: "IBOV",
              data: ibovData,
              borderColor: "#000000",
              borderWidth: 1.5,
              pointRadius: 0,
              tension: 0.15,
              fill: false,
              order: 1,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "top",
              labels: {
                usePointStyle: true,
                pointStyle: "circle",
                color: "#000000",
                font: {
                  family: "Montserrat",
                  size: legendFontSize,
                  weight: "300",
                },
              },
              reverse: true
            },
          },
          scales: {
            x: {
              type: "time",
              time: {
                unit: "month",
                displayFormats: { month: "MMM - yy" },
                tooltipFormat: "dd/MM/yyyy"
              },
              ticks: {
                color: "#000000",
                maxRotation: 45,
                minRotation: 45,
                font: {
                  family: "Montserrat",
                  size: axisFontSize,
                  weight: "300",
                },
              },
              grid: { color: "rgba(0,0,0,0.05)" },
            },
            y: {
              ticks: {
                color: "#000000",
                font: {
                  family: "Montserrat",
                  size: axisFontSize,
                  weight: "300",
                },
                callback: (v) => `${v.toFixed(0)}%`,
                stepSize: 5
              },
              grid: { color: "rgba(0,0,0,0.05)" },
            },
          },
        },
      });

      console.log("Gráfico principal criado com sucesso");
    }

    function createSideCharts(rows) {
      try {
        const concentracaoLabels = [];
        const concentracaoData = [];
        
        for (let i = 11; i <= 13; i++) {
          if (rows[i] && rows[i].length > 2) {
            const cols = rows[i].split(",");
            if (cols[1] && cols[2]) {
              concentracaoLabels.push(cols[1].trim());
              concentracaoData.push(parseFloat(cols[2].replace(",", ".")) || 0);
            }
          }
        }

        const concentracaoExNasdaqLabels = [];
        const concentracaoExNasdaqData = [];
        
        for (let i = 15; i <= 17; i++) {
          if (rows[i] && rows[i].length > 2) {
            const cols = rows[i].split(",");
            if (cols[1] && cols[2]) {
              concentracaoExNasdaqLabels.push(cols[1].trim());
              concentracaoExNasdaqData.push(parseFloat(cols[2].replace(",", ".")) || 0);
            }
          }
        }

        console.log("Dados Concentração:", concentracaoLabels, concentracaoData);
        console.log("Dados Concentração Ex Nasdaq:", concentracaoExNasdaqLabels, concentracaoExNasdaqData);

        createBarChart('concentracaoChart', concentracaoLabels, concentracaoData, 'Concentração da Carteira');
        createBarChart('concentracaoExNasdaqChart', concentracaoExNasdaqLabels, concentracaoExNasdaqData, 'Concentração da Carteira Ex Nasdaq-100');

      } catch (error) {
        console.error("Erro ao criar gráficos laterais:", error);
      }
    }

    function createBarChart(canvasId, labels, data, title) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");

      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);

      const isMobile = document.body.classList.contains('mobile-device');
      const axisFontSize = isMobile ? 17 : 15;

      const chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: [
              '#164CAD',
              '#164CAD', 
              '#164CAD'
            ],
            borderColor: [
              '#164CAD',
              '#164CAD',
              '#164CAD'
            ],
            borderWidth: 0.8,
            borderRadius: 4,
            borderSkipped: false,
            barPercentage: 0.4,
            categoryPercentage: 0.6,
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              enabled: false
            }
          },
          scales: {
            x: {
              display: false,
            },
            y: {
              position: 'left',
              ticks: {
                color: '#000',
                font: {
                  family: 'Montserrat',
                  size: axisFontSize,
                  weight: '300'
                },
                padding: 5
              },
              grid: {
                display: false
              }
            },
            xRight: {
              position: 'right',
              ticks: {
                color: '#000',
                font: {
                  family: 'Montserrat',
                  size: axisFontSize,
                  weight: '300'
                },
                callback: function(value, index) {
                  return data[index] + '%';
                }
              },
              grid: {
                display: false
              }
            }
          }
        }
      });

      // Armazenar a instância do gráfico
      if (canvasId === 'concentracaoChart') {
        window.chartInstances.concentracaoChart = chart;
      } else if (canvasId === 'concentracaoExNasdaqChart') {
        window.chartInstances.concentracaoExNasdaqChart = chart;
      }
    }

    function loadTableData(rows) {
      try {
        console.log("Carregando dados da tabela...");

        if (rows.length < 5) {
          throw new Error("Dados insuficientes para a tabela");
        }

        const headerRow = rows[1].split(",");
        const dataRows = [
          rows[2].split(","),
          rows[3].split(","),
          rows[4].split(",")
        ];

        console.log("Cabeçalhos:", headerRow.slice(22, 38));
        console.log("Dados linha 3:", dataRows[0].slice(22, 38));
        console.log("Dados linha 4:", dataRows[1].slice(22, 38));
        console.log("Dados linha 5:", dataRows[2].slice(22, 38));

        const tableHeaders = headerRow.slice(22, 38);
        
        const table = document.getElementById("dataTable");
        const tableLoading = document.getElementById("tableLoading");
        
        table.innerHTML = "";
        
        const headerRowElement = document.createElement("tr");
        headerRowElement.className = "header-row";
        
        tableHeaders.forEach((header, index) => {
          const th = document.createElement("th");
          th.textContent = header?.trim() || "";
          if (index === 0) {
            th.className = "column-w";
          }
          headerRowElement.appendChild(th);
        });
        
        table.appendChild(headerRowElement);
        
        dataRows.forEach((rowData, rowIndex) => {
          const dataRowElement = document.createElement("tr");
          
          const rowCells = rowData.slice(22, 38);
          
          if (rowIndex === 0) {
            const mergedCell = document.createElement("td");
            mergedCell.className = "merged-cell";
            mergedCell.rowSpan = 3;
            mergedCell.textContent = rowCells[0]?.trim() || "";
            dataRowElement.appendChild(mergedCell);
            
            rowCells.slice(1).forEach((cellData, cellIndex) => {
              const td = document.createElement("td");
              td.textContent = cellData?.trim() || "";
              dataRowElement.appendChild(td);
            });
          } else {
            rowCells.slice(1).forEach((cellData, cellIndex) => {
              const td = document.createElement("td");
              td.textContent = cellData?.trim() || "";
              dataRowElement.appendChild(td);
            });
          }
          
          table.appendChild(dataRowElement);
        });

        table.style.display = "table";
        tableLoading.style.display = "none";
        
        console.log("Tabela criada com sucesso");

      } catch (error) {
        console.error("Erro ao criar tabela:", error);
        document.getElementById("tableLoading").textContent = `Erro na tabela: ${error.message}`;
        document.getElementById("tableLoading").className = "error";
      }
    }

    loadData();
  </script>

  <script>
    let orientationChangeTimeout;

    function detectarDispositivo() {
      const largura = window.innerWidth;
      const altura = window.innerHeight;
      const deviceInfo = document.getElementById('deviceInfo');
      const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
      
      const isMobileSize = largura <= 1024 || 
                          (largura < altura && largura <= 768) ||
                          (isTouchDevice && (largura <= 1024 || altura <= 1024));

      const wasMobileLandscape = document.body.classList.contains('mobile-landscape');
      const isNowMobileLandscape = isMobileSize && isTouchDevice && largura > altura;

      document.body.classList.remove('desktop-device', 'mobile-device', 'mobile-landscape');

      if (isMobileSize && isTouchDevice) {
        if (largura > altura) {
          deviceInfo.textContent = "Dispositivo atual: smartphone (horizontal)";
          document.body.classList.add('mobile-device', 'mobile-landscape');
        } else {
          deviceInfo.textContent = "Dispositivo atual: smartphone (vertical)";
          document.body.classList.add('mobile-device');
        }
      } else {
        deviceInfo.textContent = "Dispositivo atual: computador";
        document.body.classList.add('desktop-device');
      }

      // Só redesenhar se realmente mudou de layout
      if (wasMobileLandscape !== isNowMobileLandscape) {
        setTimeout(redesenharGraficosSuave, 100);
      }
    }

    function ajustarAlinhamentoTabela() {
      const chartsContainer = document.querySelector('.charts-main-container');
      const tableContainer = document.querySelector('.data-table-container');
      
      if (chartsContainer && tableContainer) {
        // Forçar a mesma largura
        const chartsWidth = chartsContainer.offsetWidth;
        tableContainer.style.width = chartsWidth + 'px';
      }
    }

    function redesenharGraficosSuave() {
      if (window.chartInstances.performanceChart) {
        window.chartInstances.performanceChart.resize();
      }
      if (window.chartInstances.concentracaoChart) {
        window.chartInstances.concentracaoChart.resize();
      }
      if (window.chartInstances.concentracaoExNasdaqChart) {
        window.chartInstances.concentracaoExNasdaqChart.resize();
      }
      
      // Ajustar alinhamento da tabela
      setTimeout(ajustarAlinhamentoTabela, 50);
    }

    window.addEventListener('resize', function() {
      clearTimeout(orientationChangeTimeout);
      orientationChangeTimeout = setTimeout(detectarDispositivo, 250);
    });

    window.addEventListener('orientationchange', function() {
      clearTimeout(orientationChangeTimeout);
      orientationChangeTimeout = setTimeout(detectarDispositivo, 500);
    });
    
    setTimeout(detectarDispositivo, 100);
    detectarDispositivo();
  </script>
</body>
</html>

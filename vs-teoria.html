<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>Clube Morpheus - Gráfico de Performance</title>
<link rel="icon" href="favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">

<style>
html, body {
  margin: 0;
  padding: 0;
  background-color: #fff;
  font-family: "DM Sans", sans-serif;
  color: #000;
  height: 100%;
}

/* --- todo o seu CSS ORIGINAL permanece --- */
</style>
</head>

<body>

<!-- TODO O HTML ORIGINAL PERMANECE IGUAL -->
<!-- navbar, container, canvas, firebase etc -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script type="module">
/* =======================
   PLUGIN QUE DIVIDE O GRÁFICO
   ======================= */
const splitChartArea = {
  id: 'splitChartArea',
  beforeLayout(chart) {
    const area = chart.chartArea;
    if (!area) return;

    const totalHeight = area.bottom - area.top;
    const mainHeight = totalHeight * 0.7;
    const gap = 12;

    chart.scales.y.top = area.top;
    chart.scales.y.bottom = area.top + mainHeight;

    chart.scales['y-ao'].top = area.top + mainHeight + gap;
    chart.scales['y-ao'].bottom = area.bottom;
  }
};

/* =======================
   TODA SUA LÓGICA FIREBASE,
   CSV, TOOLTIP ETC
   ======================= */
/* (nada alterado aqui) */

/* =======================
   CRIAÇÃO DO GRÁFICO
   ======================= */
window.chartInstance = new Chart(ctx, {
  type: "line",
  plugins: [splitChartArea],
  data: {
    datasets: [
      {
        label: "Morpheus",
        data: morpheusData,
        borderColor: "#164CAD",
        borderWidth: 2,
        pointRadius: 0,
        tension: 0.15,
        fill: true,
        yAxisID: 'y',
        order: 2,
      },
      {
        label: "Teoria",
        data: teoriaData,
        borderColor: "#000",
        borderWidth: 2,
        pointRadius: 0,
        tension: 0.15,
        fill: false,
        yAxisID: 'y',
        order: 1,
      },
      {
        type: 'bar',
        label: "Dados AO",
        data: aoData,
        backgroundColor: "rgba(77,127,219,0.45)",
        borderColor: "#4D7FDB",
        borderWidth: 1,
        yAxisID: 'y-ao',
        order: 3,
        barPercentage: 1,
        categoryPercentage: 1
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    interaction: {
      intersect: false,
      mode: 'index'
    },
    plugins: {
      legend: {
        position: "top",
        reverse: true
      },
      tooltip: {
        enabled: false,
        external: (context) => {
          showCustomTooltip(context.chart, context.tooltip);
        }
      }
    },
    scales: {
      x: {
        type: "time",
        time: { unit: "month" },
        grid: { color: "rgba(0,0,0,0.05)" }
      },
      y: {
        position: 'left',
        ticks: {
          callback: v => v.toFixed(0) + '%'
        }
      },
      'y-ao': {
        position: 'left',
        grid: { drawOnChartArea: false },
        ticks: {
          callback: v => v.toFixed(1) + '%'
        }
      }
    }
  }
});
</script>

</body>
</html>

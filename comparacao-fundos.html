<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clube Morpheus</title>
  <link rel="icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "DM Sans", sans-serif;
      background-color: white;
      color: black;
      display: flex;
      flex-direction: column;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 3;
      color: white;
      box-sizing: border-box;
    }

    .navbar .welcome {
      font-weight: bold;
      white-space: nowrap;
      font-size: 16px;
    }

    .navbar .links {
      display: flex;
      gap: 20px;
      flex-wrap: nowrap;
      white-space: nowrap;
    }

    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      display: inline-block;
      transition: transform 0.2s ease-in-out;
    }

    .navbar a:hover {
      transform: scale(1.1);
    }

    .descricao-fundos {
      width: 90%;
      max-width: 1000px;
      margin: 100px auto 30px;
      text-align: center;
      font-weight: 500;
      font-size: 20px;
    }

    .main-wrapper {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding-top: 10px;
      box-sizing: border-box;
    }

    .content {
      width: 90%;
      max-width: 1000px;
      background-color: rgba(0, 0, 0, 0.05);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #000;
      color: #000;
      box-sizing: border-box;
    }

    .chart-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 30px;
      position: relative;
      min-height: 40px;
    }

    .chart-header h2 {
      font-size: 30px;
      margin: 0;
      flex-grow: 1;
      text-align: center;
    }

    .toggle-switch {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 70px;
      height: 40px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: attr(data-label-left);
      height: 32px;
      width: 32px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
      font-size: 14px;
      line-height: 32px;
      text-align: center;
      font-weight: bold;
      color: black;
    }

    input:checked + .slider {
      background-color: #000;
    }

    input:checked + .slider:before {
      transform: translateX(30px);
      content: attr(data-label-right);
    }

    canvas {
      max-width: 100%;
      height: auto;
    }

    .device-info {
      text-align: center;
      margin: 20px auto;
      padding: 10px;
      font-size: 18px;
      font-weight: bold;
      width: 90%;
      max-width: 1000px;
    }

    /* SMARTPHONE MODE */
    @media (max-width: 768px) {
      .navbar {
        padding: 5px 10px;
      }

      .navbar .welcome {
        font-size: 10px;
      }

      .navbar .links a {
        font-size: 10px;
      }

      .descricao-fundos {
        font-size: 16px;
        margin-top: 60px;
      }

      .chart-header h2 {
        font-size: 20px;
      }

      .toggle-switch {
        width: 60px;
        height: 34px;
      }

      .slider:before {
        height: 28px;
        width: 28px;
        line-height: 28px;
        font-size: 12px;
      }

      .content {
        padding: 15px;
      }

      .device-info {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="welcome" id="welcomeUser">Bem-vindo(a)</div>
    <div class="links">
      <a href="dashboard.html">Dashboard</a>
      <a href="#">Gráficos</a>
      <a href="comparacao-fundos.html">Comparação com Fundos</a>
      <a href="#" id="logoutLink">Sair</a>
    </div>
  </div>

  <div class="descricao-fundos">
    Os números abaixo representam fundos já consolidados, com décadas de histórico consistente e desempenho significativamente superior ao Ibovespa...
  </div>

  <div class="main-wrapper">
    <div class="content">
      <div class="chart-header">
        <h2>Comparação de Fundos</h2>
        <label class="toggle-switch">
          <input type="checkbox" onchange="alternarModo()" id="modoToggle">
          <span class="slider" data-label-left="Cota" data-label-right="%"></span>
        </label>
      </div>
      <canvas id="fundosChart" height="300"></canvas>
    </div>
  </div>

  <div class="device-info" id="deviceInfo"></div>

  <!-- JS DETECTOR -->
  <script>
    function detectarDispositivo() {
      const largura = window.innerWidth;
      const altura = window.innerHeight;
      const deviceInfo = document.getElementById('deviceInfo');
      const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
      const isMobileSize = largura <= 768;

      deviceInfo.textContent = isMobileSize
        ? `Dispositivo detectado: Celular (Largura: ${largura}px, Touch: ${isTouchDevice ? 'Sim' : 'Não'})`
        : `Dispositivo detectado: Computador (Largura: ${largura}px, Touch: ${isTouchDevice ? 'Sim' : 'Não'})`;
    }

    window.addEventListener('resize', detectarDispositivo);
    window.addEventListener('orientationchange', detectarDispositivo);
    detectarDispositivo();
  </script>

  <!-- CHART -->
  <script>
    let modoPercentual = false;

    function alternarModo() {
      modoPercentual = document.getElementById("modoToggle").checked;
      carregarGrafico();
    }

    async function carregarGrafico() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR0orwAIfSmQxmbGdGCvjj3CZNbRnqo3Fr0ujodTX3JIcptCrR_ElNMZZn8tJ7MVg1W7Zeu5-KvLQLM/pub?gid=0&single=true&output=csv";
      const resposta = await fetch(url);
      const texto = await resposta.text();
      const linhas = texto.split("\n").map(l => l.split(","));

      const headers = linhas[0].slice(10);
      const datas = [];
      const series = headers.map(() => []);
      const bases = headers.map(() => null);
      const variacoes = headers.map(() => []);

      for (let i = 1; i < linhas.length; i++) {
        const linha = linhas[i];
        if (!linha[9]) continue;
        datas.push(linha[9]);

        for (let j = 10; j < linha.length; j++) {
          const idx = j - 10;
          const valor = parseFloat(linha[j].replace(",", "."));
          if (!isNaN(valor)) {
            if (bases[idx] === null) bases[idx] = valor;
            series[idx].push(valor);
            variacoes[idx].push((valor / bases[idx] - 1) * 100);
          } else {
            series[idx].push(null);
            variacoes[idx].push(null);
          }
        }
      }

      const ctx = document.getElementById("fundosChart").getContext("2d");
      if (window.fundosChart) window.fundosChart.destroy();

      const cores = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40"];
      const datasets = headers.map((h, i) => ({
        label: h,
        data: modoPercentual ? variacoes[i] : series[i],
        borderColor: cores[i % cores.length],
        fill: false,
        tension: 0.3,
        borderWidth: window.innerWidth < 768 ? 2.5 : 2,
        pointRadius: window.innerWidth < 768 ? 0.8 : 1.5
      }));

      window.fundosChart = new Chart(ctx, {
        type: "line",
        data: { labels: datas, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            tooltip: {
              mode: 'index',
              intersect: false
            },
            legend: {
              labels: {
                font: {
                  size: window.innerWidth < 768 ? 10 : 14
                }
              }
            }
          },
          scales: {
            x: {
              ticks: {
                maxTicksLimit: window.innerWidth < 768 ? 4 : 12,
                font: { size: window.innerWidth < 768 ? 9 : 12 },
              }
            },
            y: {
              ticks: {
                callback: (v) => modoPercentual ? v.toFixed(1) + "%" : v.toFixed(2),
                font: { size: window.innerWidth < 768 ? 9 : 12 },
              }
            }
          }
        }
      });
    }

    carregarGrafico();
  </script>
</body>
</html>
